!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("kff",t):e.kff=t()}(this,function(){"use strict";function e(e,t){for(var i=e.length,n=t.length,s=i+n,r=0,o=new Array(s);r<i;)o[r]=e[r],r++;for(;r<s;)o[r]=t[r-i],r++;return o}function t(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}function i(e,t){if(Array.isArray(e)&&Array.isArray(t)){var i=e.length;if(i!==t.length)return!1;for(var n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}function n(e,t,i){if("function"!=typeof e[t])throw new TypeError("Expected function: "+t+" in object "+e+"  (bindFn)");return"_boundFns"in e||(e._boundFns={}),t in e._boundFns?e._boundFns[t]:(e._boundFns[t]=Function.prototype.bind.apply(e[t],i?[e].concat(i):[e]),e._boundFns[t])}function s(e,t){for(var i,n=1,s=arguments.length;n<s;){i=arguments[n];for(var r=Object.keys(i),o=0,l=r.length;o<l;o++)e[r[o]]=i[r[o]];n++}return e}function r(e,t){e.prototype=Object.create(t.prototype),e._super=t.prototype,e.prototype.constructor=e}function o(e,t){var i;0===arguments.length?e=t={}:1===arguments.length&&(t=e,e={}),i=t.hasOwnProperty("constructor")?t.constructor:e.extend?function(){e.extend.apply(this,arguments)}:function(){},e.extend&&r(i,e.extend),"mixins"in e?Array.isArray(e.mixins)||(e.mixins=[e.mixins]):e.mixins=[],e.mixins.push(te);for(var n=0,o=e.mixins.length;n<o;n++)s(t,e.mixins[n]);return e.statics&&s(i,e.statics),s(i.prototype,t),i.prototype.constructor=i,i}function l(e){return null!==e&&"object"==typeof e&&(e.constructor===Object||void 0===e.constructor)}function h(e,t){for(var i,n,s,r,o=1,u=arguments.length;o<u;){n=arguments[o];for(var a=Object.keys(n),c=0,d=a.length;c<d;c++)i=a[c],s=n[i],l(s)?(r=e[i],"object"==typeof r&&null!==r||(e[i]=r={}),h(r,s)):e[i]=s;o++}return e}function u(e){"object"==typeof console&&console.log(e)}function a(e,t){function i(s){return function(){var r=s.concat(n.call(arguments,0));return r.length>=t?e.apply(this,r):i(r)}}var n=Array.prototype.slice;return t=t||e.length,i([])}function c(){var e=arguments;return function(t){for(var i=e.length-1;i>-1;i--)t=e[i].call(this,t);return t}}function d(e){if(e instanceof Array)return e.slice();if("object"==typeof e&&null!==e){for(var t,i=Object.keys(e),n={},s=0,r=i.length;s<r;s++)t=i[s],n[t]=e[t];return n}return e}function f(e,t,i){var n,s=t;if("function"!=typeof s&&(s=function(){return t}),e){"string"==typeof e&&(e=e.split(".")),n=d(i);var r=n;if(0===e.length)return s(n);for(var o=0,l=e.length;o<l-1;o++)r=r[e[o]]=d(r[e[o]]);r[e[o]]=s(r[e[o]])}else n=s(i);return n}function p(e,t){var i;if("string"==typeof e&&(e=e.split(".")),e){i=d(t);for(var n=i,s=0,r=e.length;s<r-1;s++)n=n[e[s]]=d(n[e[s]]);Array.isArray(n)?n=n.splice(e[s],1):"object"==typeof n&&null!==n&&delete n[e[s]]}return i}function v(e,t){var i;if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e){i=d(e);for(var n,s=Object.keys(t),r=0,o=s.length;r<o;r++)n=s[r],e.hasOwnProperty(n)?i[n]=v(e[n],t[n]):i[n]=t[n];return i}if(Array.isArray(e)&&Array.isArray(t)){i=e.slice();for(var l=0,h=Math.max(e.length,t.length);l<h;l++)l in t&&(i[l]=v(i[l],t[l]));return i}return t}function m(){}function g(e){he(function(){setTimeout(e,0)})}function b(e,t){return function(i){return new e(s({},("function"==typeof t?t():t)||{},i||{}))}}function w(e){var t=/^:([a-zA-Z_$][0-9a-zA-Z_$]*)/.exec(e);return t?{match:t[1],rest:e.slice(t[0].length)}:{error:"Syntax error: expectin operator name "+e}}function y(e){var t=/^[a-zA-Z_$*%][0-9a-zA-Z_$-]*/.exec(e);return t?{match:t[0],rest:e.slice(t[0].length)}:{error:"Syntax error: expecting identifier "+e}}function _(e){var t=/^[^,()):]*/.exec(e);return t?{match:t[0],rest:e.slice(t[0].length)}:{error:"Syntax error: expecting unquoted string "+e}}function x(e){var t=/^'((\\\'|\\|[^'\\]+)*)'/.exec(e);return t?{match:t[1].replace("'","'"),rest:e.slice(t[0].length)}:{error:"Syntax error: expecting string "+e}}function A(e){var t=/^[+-]?((0(b|B)[0|1]+)|(0(o|O)[0-7]+)|(0(x|X)[0-9a-fA-F]+)|(\d+(\.\d+)?((e|E)(\+|\-)?\d+)?))/.exec(e);return t?{match:Number(t[0]),rest:e.slice(t[0].length)}:{error:"Syntax error: expecting number "+e}}function B(e){var t=/^(true|false)[^a-zA-Z0-9_$*]/.exec(e);return t?{match:t[1],rest:e.slice(t[1].length)}:{error:"Syntax error: expecting boolean "+e}}function V(e){var t=/^(null)[^a-zA-Z0-9_$*]/.exec(e);return t?{match:t[1],rest:e.slice(t[1].length)}:{error:"Syntax error: expecting null "+e}}function T(e){var t=/^(undefined)[^a-zA-Z0-9_$*]/.exec(e);return t?{match:t[1],rest:e.slice(t[1].length)}:{error:"Syntax error: expecting undefined "+e}}function S(e){var t=0===e.length;return t?{match:"eos",rest:null}:{error:"Syntax error: expecting end of string "+e}}function N(e){return e.reduce(function(e,t){return e.concat(t)},[])}function k(e,t){return!(t%2)}function E(e,t){return null!=e}function C(e){return null==e.match&&(e.match="*"),e}function R(e){var t=ve(pe([we(C,ge(y)),c(ge,ve,me,pe)([ae,ge(y)])]))(e);return t.error||(t.match=t.match.filter(k).filter(E)),t}function q(e){var t=ve(pe([be(Ce),c(ge,ve,me,pe)([be(de),be(Ce)])]))(e);return t.match&&(t={type:"params",match:t.match.filter(function(e){return null!==e&&","!==e}),rest:t.rest}),t}function I(e){var t=ve(pe([ue("("),ge(q),be(ue(")"))]))(e);return t.match&&(t={type:"params",match:t.match.filter(function(e){return"("!==e&&")"!==e}),rest:t.rest}),t}function P(e){var t=e.search(/\S/);return t===-1?"":e.slice(t)}function M(e,i,n){var s=e.querySelectorAll(n);return t(s,i)!==-1}function F(e,t,i,n){for(var s=n.target;s&&s!==e;){if(De){if(s[De](t)){n.matchedTarget=s,i.call(s,n);break}}else if(M(e,s,t)){n.matchedTarget=s,i.call(s,n);break}s=s.parentNode}}function D(e,t,i,n,s){for(var r=i.split(/\s+/),o=0,l=r.length;o<l;o++)5===arguments.length?(e[n]||(e[n]=F.bind(null,t,n,s)),t.addEventListener(r[o],e[n],!1)):t.addEventListener(r[o],n,!1)}function O(e,t,i,n){for(var s=i.split(/\s+/),r=0,o=s.length;r<o;r++)"function"!=typeof n?e[n]&&(t.removeEventListener(s[r],e[n],!1),e[n]=void 0):t.removeEventListener(s[r],n,!1)}function j(e,t,i){var n,s,r;do if(i&&(r=t.firstChild))t=r;else{for(n=t.parentNode,s=t.nextSibling;t!==e&&null===s&&null!==n;)t=n,n=t.parentNode,s=t.nextSibling;t=t&&t!==e?s:null}while(t&&1!==t.nodeType);return t}function z(e){for(var t,i,n=e,s=null,r=0,o=null;null!==(n=j(e,n,null===s));)s=null,t=n.getAttribute(ee.DATA_RENDERED_ATTR),t||(s=n.getAttribute(ee.DATA_VIEW_ATTR),!s&&n.getAttribute(ee.DATA_BIND_ATTR)&&(s="View",n.setAttribute(ee.DATA_VIEW_ATTR,s)),s&&(i=n.getAttribute(ee.DATA_OPTIONS_ATTR),null===o&&(o=[]),o.push({viewName:s,index:r,element:n,options:i?JSON.parse(i):{}}))),r++;return o}function L(e){return function(t){return t.type===e}}function H(e,t){if(Array.isArray(t))for(var i=0;i<t.length;i++)e.trigger(t[i])}function W(e,t){t instanceof Fe&&t.on(e.f("trigger"))}function Z(e,t){null!=t&&"object"==typeof t&&"type"in t&&(e.hasAction(t.type)?e.eventStream.trigger(t):e.eventStream.trigger({type:"dispatcher:noaction",value:t}))}function $(e,t){null!=t&&"object"==typeof t&&"function"==typeof t.then&&t.then(e.f("trigger"))}function K(e,t,i){return t.apply(null,i||[])}function U(e,t,i){e&&e.insertBefore(i,t)}function J(e,t,i){e&&e.removeChild(t),i()}function X(e,t){e.suspendAll(),t(e.element.parentNode,e.element,function(){e.destroyAll()})}function G(e,i,n,s){if(n&&n in i){var r=i[n];return r in s?s[r]:-1}return t(e,i)}function Q(e,t){for(var i,n=Object.keys(t),s=0,r=n.length;s<r;s++)i=n[s],e[i]=t[i];return e}function Y(e){return e.cursor.set(e.value),{type:"refreshFromRoot"}}var ee={DATA_VIEW_ATTR:"data-kff-view",DATA_OPTIONS_ATTR:"data-kff-options",DATA_RENDERED_ATTR:"data-kff-rendered",DATA_BIND_ATTR:"data-kff-bind",defaultItemAlias:"_item",immutableCollections:!1},te={f:function(e,t){if("string"==typeof e)return n(this,e,t);if("function"==typeof e)return Function.prototype.bind.apply(e,t?[this].concat(t):[this]);throw new TypeError("Expected function: "+e+" (f)")}},ie=null,ne=[],se="kff-setimmediate-msg",re=function(e){e.source===window&&e.data===se&&(e.stopPropagation(),ne.length>0&&ne.shift()())};"object"==typeof window&&"postMessage"in window&&"addEventListener"in window&&!("attachEvent"in window)?(ie=function(e){ne.push(e),window.postMessage(se,"*")},window.addEventListener("message",re,!0)):ie=function(e){setTimeout(e,0)};var oe=ie,le=a(function(e,t){return t.map(e)}),he="object"==typeof window&&window.requestAnimationFrame||function(e){setTimeout(e,1e3/60)},ue=a(function(e,t){return t[0]===e?{match:e,rest:t.slice(1)}:{error:"Syntax error: expecting character "+e+" rest:"+t}}),ae=ue("."),ce=ue("@"),de=ue(","),fe=a(function(e,t){for(var i=0;i<e.length;i++){var n=e[i](t);if(!n.error)return n}return{error:"Syntax error: cannot parse "+t}}),pe=a(function(e,t){for(var i=[],n=0;n<e.length;n++){var s=e[n](t);if(s.error)break;i.push(s.match),t=s.rest}return i.length!==e.length?s:{match:i,rest:t}}),ve=a(function(e,t){var i=e(t);return i.error?i:{match:N(i.match),rest:i.rest}}),me=a(function(e,t){for(var i=[];;){var n=e(t);if(n.error)break;i.push(n.match),t=n.rest}return 0===i.length?{error:"Syntax error: empty multiple "+t}:{match:i,rest:t}}),ge=a(function(e,t){var i=e(t);return i.error?{match:null,rest:t}:i}),be=function(e){return c(e,P)},we=a(function(e,t,i){var n=t(i);return n.error?n:e(n)}),ye=we(function(e){return{match:{type:"cursor",keyPath:e.match[1]},rest:e.rest}},pe([ce,R])),_e=we(function(e){return{match:{type:"cursorValue",keyPath:e.match[2]},rest:e.rest}},pe([ce,ce,R])),xe=we(function(e){return{match:{type:"function",name:e.match[0],params:e.match[1]},rest:e.rest}},pe([y,I])),Ae=we(function(e){return{match:{type:"number",value:e.match},rest:e.rest}},A),Be=(we(function(e){return{match:{type:"ident",value:e.match},rest:e.rest}},y),we(function(e){return{match:{type:"ident",value:e.match},rest:e.rest}},_)),Ve=we(function(e){return{match:{type:"string",value:e.match},rest:e.rest}},x),Te=we(function(e){return{match:{type:"boolean",value:"true"===e.match},rest:e.rest}},B),Se=we(function(e){return{match:{type:"null",value:null},rest:e.rest}},V),Ne=we(function(e){return{match:{type:"undefined",value:void 0},rest:e.rest}},T),ke=[Se,Ne,Te,Ae,_e,ye,Ve,Be],Ee=we(function(e){return{match:{type:"namedParam",name:e.match[0],operand:e.match[2]},rest:e.rest}},pe([be(y),be(ue(":")),be(fe(ke))])),Ce=fe([Ee,xe].concat(ke)),Re=we(function(e){return{match:{type:"operator",name:e.match[0],args:e.match[1]||[]},rest:e.rest}},pe([w,ge(I)])),qe=we(function(e){return{match:{type:"binding",keyPath:e.match[0],modelArgs:e.match[1]||[],binder:e.match[2],binderArgs:e.match[3]||[],operators:e.match[4]||[]},rest:e.rest}},be(pe([R,ge(I),w,ge(I),ge(me(Re))]))),Ie=we(function(e){return{match:{bindings:e.match.filter(function(e){return"eos"!==e})},rest:e.rest}},ve(pe([be(me(qe)),be(S)]))),Pe=Object.freeze({matchIdentifier:y,matchNumber:A,matchKeyPath:R,matchBindingOperatorName:w,matchOr:fe,matchCursor:ye,matchCursorValue:_e,skipWhiteSpace:be,matchOperatorParams:I,matchBinding:qe,matchBindings:Ie}),Me=o({constructor:function(t,i){"string"==typeof i&&(i=i.split(".")),this.keyPath=i||[],t instanceof Me?(this.superRoot=t.superRoot,this.keyPath=e(t.keyPath,this.keyPath)):this.superRoot={root:t}},refine:function(e){return new Me(this,e)},get:function(){return this.getInPath(this.keyPath)},getIn:function(e){return"string"==typeof e&&(e=e.split(".")),this.getInPath(this.keyPath.concat(e))},getInPath:function(e){var t,i,n,s=this.superRoot.root;for(i=0,n=e.length;i<n;i++){if(t=e[i],"object"!=typeof s||null===s||void 0===s[t])return null;s=s[t]}return s},set:function(e){this.superRoot.root=f(this.keyPath,e,this.superRoot.root)},setIn:function(e,t){this.refine(e).set(t)},update:function(e){this.superRoot.root=f(this.keyPath,e,this.superRoot.root)},remove:function(){this.superRoot.root=p(this.keyPath,this.superRoot.root)},equalsTo:function(e){return!(!e||e.superRoot.root!==this.superRoot.root)&&i(this.keyPath,e.keyPath)}}),Fe=o({statics:{END:{}}},{constructor:function(){this.subscribers=[],this.oneSubscribers=[],this.endSubscribers=[]},on:function(e){return t(this.subscribers,e)===-1&&this.subscribers.push(e),this},onEnd:function(e){return t(this.endSubscribers,e)===-1&&this.endSubscribers.push(e),this},one:function(e,t){return this.oneSubscribers.push(t),this.on(t)},off:function(e){var i=t(this.subscribers,e);return i!==-1&&this.subscribers.splice(i,1),i=t(this.oneSubscribers,e),i!==-1&&this.oneSubscribers.splice(i,1),i=t(this.endSubscribers,e),i!==-1&&this.endSubscribers.splice(i,1),this},offAll:function(){return this.subscribers=[],this.oneSubscribers=[],this.endSubscribers=[],this},trigger:function(e){var t,i;if(e===Fe.END){for(t=0,i=this.endSubscribers.length;t<i;t++)"function"==typeof this.endSubscribers[t]&&this.endSubscribers[t].call(null);return this.offAll()}for(t=0,i=this.subscribers.length;t<i;t++)"function"==typeof this.subscribers[t]&&this.subscribers[t].call(null,e);for(t=0,i=this.oneSubscribers.length;t<i;t++)this.off(this.oneSubscribers[t]);return this},triggerLater:function(e,t){var i=this;return void 0===t&&(t=0),setTimeout(function(){i.trigger(e)},t),this},map:function(e){var t=new Fe;return this.on(function(i){t.trigger(e.call(null,i))}),this.onEnd(function(){t.end()}),t},reduce:function(e,t){var i,n=new Fe;if("function"!=typeof e)throw new TypeError(e+" is not a function");return arguments.length>=2&&(i=arguments[1]),this.on(function(t){i=e.call(null,i,t)}),this.onEnd(function(){n.trigger(i).end()}),n},flatMap:function(e){var t=new Fe,i=0,n=function(n){var s=e.call(null,n);s instanceof Fe?(i++,s.on(function(e){t.trigger(e)}),s.onEnd(function(){i--,0===i&&t.end()})):t.trigger(s)};return this.on(n),this.onEnd(function(){0===i&&t.end()}),t},filter:function(e){var t=new Fe;return this.on(function(i){e.call(null,i)&&t.trigger(i)}),this.onEnd(function(){t.end()}),t},merge:function(e){function t(){n--,0===n&&i.end()}var i=new Fe,n=2;return this.on(i.f("trigger")),e.on(i.f("trigger")),this.onEnd(t),e.onEnd(t),i},end:function(){this.trigger(Fe.END)},endLater:function(e){var t=this;return void 0===e&&(e=0),setTimeout(function(){t.trigger(Fe.END)},e),this}});if("object"==typeof document&&null!==document){var De;"webkitMatchesSelector"in document.documentElement?De="webkitMatchesSelector":"mozMatchesSelector"in document.documentElement?De="mozMatchesSelector":"oMatchesSelector"in document.documentElement?De="oMatchesSelector":"msMatchesSelector"in document.documentElement&&(De="msMatchesSelector")}var Oe=o({constructor:function(e,t){this.eventStream=new Fe,this.actionStreams={},this.processors=[H,W,$,Z],t&&Array.isArray(t)&&(this.processors=this.processors.concat(t)),this.registerActions(e),this.callbacks=[]},createCallback:function(e){var t=this;if("function"!=typeof e)throw new Error('Dispatcher action "'+e+'" is not a function');return e.length<=1?function(i){var n=e.call(null,i);t.trigger(n)}:function(i){var n=function(e,i){e||i&&t.trigger(i)};e.call(null,i,n)}},registerActions:function(e){if("object"==typeof e)for(var t in e)"function"==typeof e[t]&&(this.actionStreams[t]=this.eventStream.filter(L(t)).on(this.createCallback(e[t])))},trigger:function(e){for(var t=0;t<this.processors.length;t++)"function"==typeof this.processors[t]&&this.processors[t](this,e)},on:function(e,t){e in this.actionStreams||(this.actionStreams[e]=this.eventStream.filter(L(e)));var i=this.createCallback(t);this.callbacks.push({type:e,fn:t,callback:i}),this.actionStreams[e].on(i)},off:function(e,t){for(var i=this.callbacks.length-1;i>=0;i--)this.callbacks[i].type===e&&this.callbacks[i].fn===t&&(e in this.actionStreams&&this.actionStreams[e].off(this.callbacks[i].callback),this.callbacks.splice(i,1))},hasAction:function(e){return e in this.actionStreams}}),je=o({constructor:function(e){this.collection=null,this.keyPath=e.keyPath,this.collectionArgs=e.collectionArgs,this.view=e.view,this.elementTemplate=null,this.boundViews=null,this.anchor=null,this.viewTemplate=null,this.animate=e.animate,this.keyProp=e.keyProp},renderBoundViews:function(){this.anchor=this.view.env.document.createTextNode("");var e=this.view.element;e.parentNode&&(e.parentNode.insertBefore(this.anchor,e.nextSibling),e.parentNode.removeChild(e)),this.boundViews=[],this.boundViewName=this.view.element.getAttribute(ee.DATA_VIEW_ATTR);var t=this.view.element.getAttribute(ee.DATA_OPTIONS_ATTR);this.boundViewOptions=t?JSON.parse(t):{},this.boundViewOptions.parentView=this.view,this.boundViewOptions.env=this.view.env,this.boundViewOptions.isBoundView=!0,this.refreshBoundViews()},destroyBoundViews:function(){var e,t,i;if(null!==this.boundViews){for(t=0,i=this.boundViews.length;t<i;t++)e=this.boundViews[t],e.destroyAll(),e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element);this.boundViews=null}this.anchor&&(this.anchor.parentNode&&(this.anchor.parentNode.insertBefore(this.view.element,this.anchor.nextSibling),this.anchor.parentNode.removeChild(this.anchor)),this.anchor=null),this.elementTemplate&&(this.elementTemplate.parentNode&&this.elementTemplate.parentNode.removeChild(this.elementTemplate),this.elementTemplate=null),this.viewTemplate=null,this.collection&&(this.collection=null)},refreshAll:function(){if(null!==this.boundViews)for(var e=0,t=this.boundViews.length;e<t;e++)this.boundViews[e].refreshAll()},refreshBoundViews:function(e){this.refreshBoundViewsAll()},rebindCollection:function(){this.cursor=this.view.getCursor(this.keyPath),this.collection=this.cursor.get(),"function"==typeof this.collection&&(this.collection=K.call(this.view,this.collection,this.collectionArgs)),Array.isArray(this.collection)||(this.collection=[])},refreshBoundViewsAll:function(){var e,t,i,n,s,r,o,l,h=U,u=J,a=this.collection;if(this.animate&&(h=this.view.scope[this.animate].insert,u=this.view.scope[this.animate].remove),this.rebindCollection(),!ee.immutableCollections||a!==this.collection)if(null===this.boundViews&&(this.boundViews=[]),0===this.boundViews.length){if(i=this.collection.length,i>0&&(s=this.collection,o=this.anchor,this.anchor&&this.anchor.parentNode))for(l=this.anchor.parentNode,t=0;t<i;t++)e=this.createBoundView(s[t]),this.boundViews[t].runAll(),this.boundViews[t].afterRunAll(),n=e.element,h(l,o.nextSibling,n),o=n}else{var c,d,f=this.collection,p=[],v=[];if(this.keyProp){for(c={},t=0,i=a.length;t<i;t++)c[a[t][this.keyProp]]=t;for(d={},t=0,i=f.length;t<i;t++)d[f[t][this.keyProp]]=t}var m=[];for(t=0,i=Math.max(a.length,f.length);t<i;t++)if(a[t]&&G(f,a[t],this.keyProp,d)===-1&&(e=this.boundViews[t],this.animate?(m.push(e),r=e):r=null,v.push(e)),f[t]){var g=G(a,f[t],this.keyProp,c);g!==-1?(e=this.boundViews[g],m.push(e),e.scope["*"]=this.cursor.refine([t]),this.view._itemAlias&&(e.scope[this.view._itemAlias]=e.scope["*"]),e.setBindingIndex(t),p.push(e),r=e):(this.animate||0===v.length?(e=this.createBoundView(f[t]),e.scope["*"]=this.cursor.refine([t]),this.view._itemAlias&&(e.scope[this.view._itemAlias]=e.scope["*"]),e.setBindingIndex(t),e.runAll(),e.afterRunAll()):(e=v.shift(),e.scope["*"]=this.cursor.refine([t]),this.view._itemAlias&&(e.scope[this.view._itemAlias]=e.scope["*"]),e.setBindingIndex(t)),m.push(e),p.push(e),r=null)}if(r)for(o=r.element,t=m.length-1,n=m[t].element,n!==o&&o.parentNode&&1===o.parentNode.nodeType&&n!==o.nextSibling&&(h(o.parentNode,o.nextSibling,n),o=n);t>=0;t--){n=m[t].element;var b=n.nextSibling;n!==o&&b!==o&&o.parentNode&&1===o.parentNode.nodeType&&h(o.parentNode,o,n),o=n,m[t].refreshIndexedBinders(!0)}else for(o=this.anchor,this.anchor.parentNode&&(l=this.anchor.parentNode),t=0,i=m.length;t<i;t++)n=m[t].element,n!==o.nextSibling&&h(l,o.nextSibling,n),m[t].refreshIndexedBinders(!0),o=n;for(this.boundViews=p,t=0,i=v.length;t<i;t++){var w=v[t];w.element&&w.element.parentNode&&X(w,u)}}},reindexBoundviews:function(e,t){e||(e=0),(!t||t>this.boundViews.length)&&(t=this.boundViews.length);for(var i=e;i<t;i++)this.boundViews[i].setBindingIndex(i),this.boundViews[i].refreshBinders(!0)},createBoundView:function(e){var t,i,n;return this.viewTemplate?(i=this.elementTemplate.cloneNode(!0),t=this.viewTemplate._clone(),t._setParentView(this.view),this.boundViews.push(t),n=this.boundViews.length-1,t.scope["*"]=this.cursor.refine([n]),this.view._itemAlias&&(t.scope[this.view._itemAlias]=t.scope["*"]),t.setBindingIndex(n),t._rebindElement(i)):(i=this.view.element.cloneNode(!0),this.boundViewOptions.element=i,t=new this.view.constructor(this.boundViewOptions),t._collectionBinder=null,t._modelBindersMap=this.view._modelBindersMap.clone(),this.boundViews.push(t),n=this.boundViews.length-1,t.scope["*"]=this.cursor.refine([n]),this.view._itemAlias&&(t.scope[this.view._itemAlias]=t.scope["*"]),t.setBindingIndex(n),t.renderAll(),this.viewTemplate=t._clone(),this.elementTemplate=i.cloneNode(!0)),i.setAttribute(ee.DATA_RENDERED_ATTR,!0),t._itemAlias=this.view._itemAlias,t._modelBindersMap.setView(t),t},refreshBinders:function(e){if(this.refreshBoundViews(),null!==this.boundViews)for(var t=0,i=this.boundViews.length;t<i;t++)this.boundViews[t].refreshBinders(e)},refreshIndexedBinders:function(){if(null!==this.boundViews)for(var e=0,t=this.boundViews.length;e<t;e++)this.boundViews[e].refreshIndexedBinders()},getCollectionIndex:function(e){return Array.isArray(this.collection)?t(this.collection,e):-1}}),ze=o({constructor:function(){this.binders=[]},add:function(e){this.binders.push(e)},clone:function(){for(var e=new ze,t=e.binders,i=this.binders.length;i--;)t[i]=this.binders[i].clone();return e},setView:function(e){var t,i,n;for(t=0,i=this.binders.length;t<i;t++)n=this.binders[t],n.view=e,n.element=e.element,n.model=null,n.value=null},initBinders:function(){for(var e=0,t=this.binders.length;e<t;e++)this.binders[e].init()},destroyBinders:function(){for(var e=0,t=this.binders.length;e<t;e++)this.binders[e].destroy()},refreshBinders:function(e){for(var t=0,i=this.binders.length;t<i;t++)this.binders[t].modelChange(null,e)},afterRun:function(e){for(var t=0,i=this.binders.length;t<i;t++)this.binders[t].afterRun()},rebindCursors:function(){for(var e=0,t=this.binders.length;e<t;e++)this.binders[e].rebindCursor()},refreshIndexedBinders:function(){for(var e=0,t=this.binders.length;e<t;e++)this.binders[e].isIndexed()&&this.binders[e].modelChange(null,!0)}}),Le=o({statics:{binders:{},helpers:{},registerBinder:function(e,t){Le.binders[e]=t},registerHelper:function(e,t){Le.helpers[e]=t}}},{constructor:function(e){e=e||{},this._modelBindersMap=null,this._collectionBinder=null,this._bindingIndex=null,this._itemAlias=null,this._subviewsStruct=null,this._explicitSubviewsStruct=null,this._pendingRefresh=!1,this._subviewsArgs=null,this._isRunning=!1,this._isSuspended=!1,this._template=null,this._isolated=!1,this.subviews=null,e.isolated&&(this._isolated=!0),e.parentView?(this.scope=e.scope||null,this._setParentView(e.parentView)):e.scope?this.scope=Q({},e.scope):this.scope={},e.scope=null,e.events?this.domEvents=e.events.slice():this.domEvents=[],e.dispatcher?this.dispatcher=e.dispatcher:this.dispatcher=null,e.actions?this.actions=Q({set:Y},e.actions):null!=this.parentView&&!this._isolated||e._clone?this.actions=null:this.actions={set:Y},e.env?this.env=e.env:this.env={document:document,window:window},e.element?(this.element=e.element,e.element=null):this.element=this.env.document.body,this.options=e},render:m,run:m,afterRun:m,suspend:m,resume:m,refresh:m,destroy:m,initAll:function(){this.renderAll(),this.runAll(),this.afterRunAll()},renderAll:function(){this._modelBindersMap||this._initBinding(),this._collectionBinder||(this._explicitSubviewsStruct=null,this._template&&(this.element.innerHTML=this._template),this.render!==m&&this.render(),this.renderSubviews())},runAll:function(){this._collectionBinder?this.runSubviews():(this._modelBindersMap&&this._modelBindersMap.initBinders(),this.run!==m&&this.run(),this.runSubviews(),this.delegateEvents(),this.actions&&(this.dispatcher||(this.dispatcher=new Oe),this.dispatcher.registerActions(this.actions)),this.dispatcher&&(this.dispatcher.on("refresh",this.f("refreshAll")),this.dispatcher.on("refreshFromRoot",this.f("refreshFromRoot")),this.dispatcher.on("dispatcher:noaction",this.f("_dispatchNoAction"))),"function"==typeof this.afterRender&&this.afterRender(),this.element.setAttribute(ee.DATA_RENDERED_ATTR,!0),this._refreshOwnBinders(!0)),this._isRunning=!0},afterRunAll:function(){this._modelBindersMap&&this._modelBindersMap.afterRun(),this._collectionBinder?this.afterRunSubviews():(this.afterRun!==m&&this.afterRun(),this.afterRunSubviews())},isSuspended:function(){return this._isSuspended},suspendAll:function(){this._isSuspended||(this._collectionBinder?this.suspendSubviews():(this._isSuspended=!0,this.suspend!==m&&this.suspend(),this.suspendSubviews()))},resumeAll:function(){this._isSuspended&&(this._collectionBinder?this.resumeSubviews():(this._isSuspended=!1,this.resume!==m&&this.resume(),this.resumeSubviews()))},requestRefreshAll:function(){this.env.window.requestAnimationFrame?this._pendingRefresh||(this._pendingRefresh=!0,this.env.window.requestAnimationFrame(this.f("refreshAll"))):this.refreshAll()},refreshAll:function(){if(this._isRunning&&!this._isSuspended){var e=!0;if("function"==typeof this.shouldRefresh&&(e=this.shouldRefresh()),e)if("function"==typeof this.refresh&&this.refresh(),this._collectionBinder)this._collectionBinder.refreshBoundViews(),this._collectionBinder.refreshAll();else if(this._rebindCursors(),this._refreshOwnBinders(),null!==this.subviews)for(var t=0,i=this.subviews.length;t<i;t++)this.subviews[t].refreshAll();this._pendingRefresh=!1}},refreshFromRoot:function(){for(var e=this;e.parentView;)e=e.parentView;null!==e.dispatcher&&e.dispatcher.trigger({type:"refresh"})},destroyAll:function(){this._destroyBinding(),this._collectionBinder&&this._collectionBinder.destroyBoundViews(),this._modelBindersMap=null,this._collectionBinder=null,this._bindingIndex=null,this._itemAlias=null,this.element.removeAttribute(ee.DATA_RENDERED_ATTR),this.undelegateEvents(),this.destroySubviews(),this.dispatcher&&(this.dispatcher.off("refresh",this.f("refreshAll")),this.dispatcher.off("refreshFromRoot",this.f("refreshFromRoot")),this.dispatcher.off("dispatcher:noaction",this.f("_dispatchNoAction"))),this.destroy!==m&&this.destroy(),"function"==typeof this.afterDestroy&&this.afterDestroy(),this._subviewsStruct=null,this._explicitSubviewsStruct=null,this.subviews=null,this._isRunning=!1,this._isSuspended=!1},renderSubviews:function(){if(!this._collectionBinder){var t,i,n,s,r=this.element,o=null;if(r&&(this._subviewsStruct=z(r)),null!==this._explicitSubviewsStruct?(null===this._subviewsStruct&&(this._subviewsStruct=[]),o=e(this._subviewsStruct,this._explicitSubviewsStruct)):null!==this._subviewsStruct&&(o=this._subviewsStruct.slice()),null!==o)for(t=0,i=o.length;t<i;t++)s=o[t].options,s.element=o[t].element,s.env=this.env,n=this.createView(o[t].viewName,s),n instanceof Le&&n.renderAll()}},runSubviews:function(){if(this._collectionBinder)this._collectionBinder.renderBoundViews();else if(this.subviews)for(var e=0,t=this.subviews.length;e<t;e++)this.subviews[e].runAll()},afterRunSubviews:function(){if(this.subviews)for(var e=0,t=this.subviews.length;e<t;e++)this.subviews[e].afterRunAll()},suspendSubviews:function(){if(this.subviews)for(var e=0,t=this.subviews.length;e<t;e++)this.subviews[e].suspendAll()},resumeSubviews:function(){if(this.subviews)for(var e=0,t=this.subviews.length;e<t;e++)this.subviews[e].resumeAll()},destroySubviews:function(){if(this._collectionBinder)this._collectionBinder.destroyBoundViews();else{var e,t,i;if(null!==this.subviews)for(t=0,i=this.subviews.length;t<i;t++)e=this.subviews[t],e.destroyAll();this.subviews=null,this._subviewsStruct=null}},rerender:function(e){this.destroyAll(),void 0!==e&&(this.element.innerHTML=e),this.initAll()},getCursor:function(e){"string"==typeof e&&(e=e.split("."));var t=e[0];e=e.slice(1);var i=this.scope[t];i instanceof Me||(i=new Me(i,e));var n=i.refine(e);return n},addEvents:function(e){return Array.isArray(e)?(Array.isArray(e[0])||(e=Array.prototype.slice.apply(arguments)),void Array.prototype.push.apply(this.domEvents,e)):void(2!==arguments.length&&3!==arguments.length||this.domEvents.push(Array.prototype.slice.apply(arguments)))},delegateEvents:function(e,t){var i,n,s,r;for(this.undelegateEvents(e,t),e=e||this.domEvents,t||(t=this.element,this.env&&t===this.env.document.body&&(t=this.env.document)),n=0,s=e.length;n<s;n++)i=e[n],i.length>=3?(r="string"==typeof i[2]?this.f(i[2]):i[2],"string"==typeof i[1]?D(this.handlers,t,i[0],i[1],r):i[1].on(i[0],r)):2===i.length&&(r="string"==typeof i[1]?this.f(i[1]):i[1],D(this.handlers,t,i[0],r))},undelegateEvents:function(e,t){var i,n,s,r;for(e=e||this.domEvents,this.handlers||(this.handlers={}),t||(t=this.element,this.env&&t===this.env.document.body&&(t=this.env.document)),n=0,s=e.length;n<s;n++)i=e[n],i.length>=3?(r="string"==typeof i[2]?this.f(i[2]):i[2],"string"==typeof i[1]?O(this.handlers,t,i[0],i[1]):i[1].off(i[0],r)):2===i.length&&(r="string"==typeof i[1]?this.f(i[1]):i[1],O(this.handlers,t,i[0],r))},createView:function(e,t){var i,n;return this._subviewsArgs&&Array.isArray(this._subviewsArgs[e])&&(n=this._subviewsArgs[e],"object"==typeof n[0]&&null!==n[0]&&(t=v(t,n[0]))),t.parentView=this,"View"===e?i=new Le(t):e in this.scope&&(i=new this.scope[e](t)),i instanceof Le&&(null===this.subviews&&(this.subviews=[]),this.subviews.push(i)),i},addSubview:function(e,t,i){null===this._explicitSubviewsStruct&&(this._explicitSubviewsStruct=[]),this._explicitSubviewsStruct.push({viewName:t,element:e,options:i||{}})},setTemplate:function(e){this._template=e},refreshBinders:function(e){if(this._collectionBinder)this._collectionBinder.refreshBinders(e);else if(this._refreshOwnBinders(e),null!==this.subviews)for(var t=0,i=this.subviews.length;t<i;t++)this.subviews[t].refreshBinders(e)},refreshIndexedBinders:function(){if(this._collectionBinder)this._collectionBinder.refreshIndexedBinders();else if(this._modelBindersMap&&this._modelBindersMap.refreshIndexedBinders(),null!==this.subviews)for(var e=0,t=this.subviews.length;e<t;e++)this.subviews[e].refreshIndexedBinders()},dispatchEvent:function(e){if(!this._isSuspended)for(var t=this;t;){if(null!==t.dispatcher&&t.dispatcher.hasAction(e.type)){t.dispatcher.trigger(e);break}t=t._isolated?null:t.parentView}},getBindingIndex:function(e){return e=e||"*",null!==this._bindingIndex&&this.scope.hasOwnProperty(e)?this._bindingIndex:this.parentView instanceof Le?this.parentView.getBindingIndex(e):null},setBindingIndex:function(e){this._bindingIndex=e},_dispatchNoAction:function(e){this.parentView&&this.parentView.dispatchEvent(e.value)},_clone:function(){var e,t,i=this.options;i.parentView=null,i.env=this.env,i._clone=!0;var n=new this.constructor(i);if(null!==this.subviews)for(e=this.subviews.length,n.subviews=new Array(e);e--;)t=this.subviews[e]._clone(),n.subviews[e]=t;return null!==this._subviewsStruct&&(n._subviewsStruct=this._subviewsStruct.slice()),null!==this._explicitSubviewsStruct&&(n._explicitSubviewsStruct=this._explicitSubviewsStruct.slice()),this._collectionBinder&&(n._collectionBinder=new je({view:n,keyPath:this._collectionBinder.keyPath,animate:this._collectionBinder.animate,keyProp:this._collectionBinder.keyProp,collection:null,collectionPathArray:this._collectionBinder.collectionPathArray})),this._modelBindersMap&&(n._modelBindersMap=this._modelBindersMap.clone(),n._modelBindersMap.setView(n)),n._itemAlias=this._itemAlias,n},_setParentView:function(e){var t,i,n,s;if(this.parentView=e,!this._isolated&&(t=this.scope||null,this.scope=Object.create(e.scope),t)){var r=Object.keys(t);for(n=0,s=r.length;n<s;n++)i=r[n],this.scope[i]=t[i]}if(this.scope||(this.scope={}),null!==this.subviews)for(n=0,s=this.subviews.length;n<s;n++)this.subviews[n]._setParentView(this)},_rebindElement:function(e){this.element=e,this._rebindSubViews(e,{subviewIndex:0,subviewsStructIndex:0,index:0}),this._modelBindersMap&&this._modelBindersMap.setView(this),this._collectionBinder&&(this._collectionBinder.view=this);
},_rebindSubViews:function(e,t){var i=e,n=!0,s=this.subviews,r=this._subviewsStruct;if(null!==r)for(null===s&&(this.subviews=s=[]);null!==(i=j(e,i,n));)r[t.subviewIndex]&&(t.subviewsStructIndex=r[t.subviewIndex].index,t.index===t.subviewsStructIndex?(s[t.subviewIndex]&&s[t.subviewIndex]._rebindElement(i),t.subviewIndex++,n=!1):n=!0),t.index++},_initBinding:function(){var e,t=this.element.getAttribute(ee.DATA_BIND_ATTR);if(this._modelBindersMap=new ze,null!=t){var i=Ie(t);if(i.match&&i.match.bindings){i=i.match.bindings;for(var e=0,n=i.length;e<n;e++){var s=i[e];if("each"===s.binder){if(!this.options.isBoundView){var r=null,o=null,l=null;if(s.operators)for(var h=0,u=s.operators.length;h<u;h++){var a=s.operators[h];a.args.length>=1&&"ident"===a.args[0].type&&("animate"===a.name&&(r=a.args[0].value),"key"===a.name&&(o=a.args[0].value),"as"===a.name&&(l=a.args[0].value))}this._collectionBinder=new je({view:this,keyPath:s.keyPath,collectionArgs:s.modelArgs,animate:r,keyProp:o}),l?this._itemAlias=l:this._itemAlias=ee.defaultItemAlias}}else{if(!(s.binder in Le.binders))break;for(var c=this.scope,d=function(e){return null!=e&&"ident"===e.type},f=function(e){return c[e.value]?{fn:c[e.value],args:[]}:Le.helpers[e.value]?{fn:Le.helpers[e.value],args:[]}:void 0},p=function(e){return e.value},v=function(e){return null!=e},m={view:this,element:this.element,params:s.binderArgs.filter(v),keyPath:s.keyPath,modelArgs:s.modelArgs.filter(v),formatters:[],parsers:[],dispatch:null,eventNames:[],eventFilters:null,fill:!1,nopreventdef:!1,animate:null,indexed:!1},h=0,u=s.operators.length;h<u;h++){var a=s.operators[h];switch(a.name){case"format":case"f":m.formatters=a.args.filter(d).map(f);break;case"parse":case"p":m.parsers=a.args.filter(d).map(f);break;case"dispatch":a.args.length>0&&(m.dispatch=a.args);break;case"on":a.args.length>0&&(m.eventNames=a.args.filter(d).map(p));break;case"evf":m.eventFilters=a.args.filter(d).map(f);break;case"fill":m.fill=!0;break;case"nopreventdef":m.nopreventdef=!0;break;case"animate":m.animate=a.args[0].value}}for(var h=m.formatters.length-1;h>=0;h--)m.formatters[h].fn.indexed===!0&&(m.indexed=!0);var g=new Le.binders[s.binder](m);this._modelBindersMap.add(g)}}}}},_destroyBinding:function(){this._modelBindersMap&&(this._modelBindersMap.destroyBinders(),this._modelBindersMap=null)},_rebindCursors:function(){this._modelBindersMap&&this._modelBindersMap.rebindCursors()},_refreshOwnBinders:function(e){this._modelBindersMap&&this._modelBindersMap.refreshBinders(e)}});!function(){var e=function(e,t){var i=this.getBindingIndex(t);return null!==i?i:e};e.indexed=!0,Le.registerHelper("index",e);var t=function(e,t){var i=this.getBindingIndex(t);return null!==i?i+1:e};t.indexed=!0,Le.registerHelper("indexFromOne",t)}(),Le.registerHelper("boolean",function(e){var t=parseInt(e,10);return isNaN(t)?"true"===e:!!t}),Le.registerHelper("not",function(e){return!e}),Le.registerHelper("null",function(e){return null===e||"null"===e?null:e}),Le.registerHelper("int",function(e){return e=parseInt(e,10),isNaN(e)&&(e=0),e}),Le.registerHelper("float",function(e){return e=parseFloat(e),isNaN(e)&&(e=0),e}),Le.registerHelper("string",function(e){return e.toString()});var He=o({constructor:function(e){this.options=e,this.options.events=e.events||null,this.view=e.view,this.element=e.element,this.cursor=null,this.keyPath=e.keyPath,this.subKeyPath=this.keyPath.slice(1),this.rootCursorName=this.keyPath[0],this.rootCursor=null,this.dispatch=e.dispatch,this.currentValue=null,this.value=null,this.animate=e.animate,this.willFill=e.fill},init:function(){this.options.nobind||this.element&&null!==this.options.events&&this.delegateEvents(this.options.events),this.rebindCursor()},destroy:function(){this.element&&null!==this.options.events&&this.undelegateEvents(this.options.events),this.currentValue=null,this.value=null},afterRun:function(){this.options.fill&&(this.fill(),this.willFill=!1)},delegateEvents:Le.prototype.delegateEvents,undelegateEvents:Le.prototype.undelegateEvents,modelChange:function(e,t){var i,n;i=this.cursor.get(),"function"==typeof i&&(i=K(this.view,i,this.options.modelArgs.map(this.f(function(e){return this.convertBindingValue(e)})))),"undefined"!==i&&(n=this.format(i),this.willFill||!t&&this.compareValues(n,this.value)||(this.value=n,this.currentValue=i,this.refresh()))},compareValues:function(e,t){return e===t},getFormattedValue:function(){return this.value},updateModel:function(e,t){var i,n,s;if(this.value=e,Array.isArray(e))for(i=0,n=e.length;i<n;i++)e[i]=this.parse(e[i]);else e=this.parse(e);if(!this.compareValues(e,this.currentValue)){this.currentValue=e;var r=[];if(s={type:"set",cursor:this.cursor,value:e,domEvent:t,params:r},this.dispatch&&this.dispatch.length>0)for(s.type=this.convertBindingValue(this.dispatch[0]),i=1,n=this.dispatch.length;i<n;i++){var o=this.convertBindingValue(this.dispatch[i]);null!==o&&"object"==typeof o&&"key"in o?s[o.key]=o.value:r.push(o)}this.view.dispatchEvent(s)}},convertBindingValue:function(e){if(null==e)return e;switch(e.type){case"ident":case"string":return e.value;case"namedParam":return{key:e.name,value:this.convertBindingValue(e.operand)};case"cursor":return this.view.getCursor(e.keyPath);case"cursorValue":var t=this.view.getCursor(e.keyPath);return t instanceof Me?t.get():void 0;default:return e.value}},format:function(t){var i,n,s,r,o;for(i=0,n=this.options.formatters.length;i<n;i++)if(Array.isArray(t)){for(o=[],s=0,r=t.length;s<r;s++)o[s]=this.options.formatters[i].fn.apply(this,e([t[s]],this.options.formatters[i].args));t=o}else t=this.options.formatters[i].fn.apply(this,e([t],this.options.formatters[i].args));return t},parse:function(t){var i,n,s,r,o;for(i=0,n=this.options.parsers.length;i<n;i++)if(Array.isArray(t)){for(o=[],s=0,r=t.length;s<r;s++)o[s]=this.options.parsers[i].fn.apply(this,e([t[s]],this.options.parsers[i].args));t=o}else t=this.options.parsers[i].fn.apply(this,e([t],this.options.parsers[i].args));return t},getBindingIndex:function(e){return e=e||this.options.modelName,this.view.getBindingIndex(e)},clone:function(){return new this.constructor(this.options)},refresh:m,fill:m,rebindCursor:function(){var e=this.view.scope[this.rootCursorName];return this.rootCursor!==e&&(this.rootCursor=e,e instanceof Me?this.cursor=e.refine(this.subKeyPath):this.cursor=new Me(e,this.subKeyPath)),this.cursor},isIndexed:function(){return this.options.indexed},createFilterTriggerEvent:function(e,t){return function(i){return t.fn.apply(this,[e,i].concat(t.args))}}}),We=o({extend:Le},{constructor:function(e){Le.call(this,e),this.scope["*"]=new Me({})}}),Ze=o({extend:He},{constructor:function(e){var t=e.eventNames.length>0?e.eventNames.join(" "):"click";e.events=[[t,"triggerEvent"]],He.call(this,e),this.userValue=void 0,this.valueCursor=void 0},init:function(){this.userValue=null,this.valueCursor=void 0,this.options.params[0]&&(this.userValue=this.convertBindingValue(this.options.params[0]),this.userValue instanceof Me&&(this.valueCursor=this.userValue,this.userValue=this.valueCursor.get())),this.options.eventFilters&&this.options.eventFilters[0]&&(this.triggerEvent=this.createFilterTriggerEvent(this.triggerEvent,this.options.eventFilters[0])),Ze._super.init.call(this)},triggerEvent:function(e){this.options.nopreventdef||e.preventDefault(),this.valueCursor&&(this.userValue=this.valueCursor.get()),this.updateModel(this.userValue,e)},compareValues:function(e,t){return!1}});Le.registerBinder("event",Ze);var $e=o({extend:He},{constructor:function(e){He.call(this,e)},init:function(){this.attribute=this.options.params[0]?this.convertBindingValue(this.options.params[0]):null,this.prefix=this.options.params[1]?this.convertBindingValue(this.options.params[1]):"",this.suffix=this.options.params[2]?this.convertBindingValue(this.options.params[2]):"",$e._super.init.call(this)},refresh:function(){var e=this.value;null!==e&&void 0!==e||(e=""),this.attribute&&this.element.setAttribute(this.attribute,this.prefix+e+this.suffix)}});Le.registerBinder("attr",$e);var Ke=o({extend:He},{constructor:function(e){var t=e.eventNames.length>0?e.eventNames.join(" "):"click";e=e||{},e.events=[[t,"inputChange"]],He.call(this,e),this.options.fill&&(this.fillVal=this.element.checked),this.equalsTo=void 0,this.valueCursor=void 0},init:function(){this.equalsTo=!0,this.options.params[0]&&(this.equalsTo=this.convertBindingValue(this.options.params[0]),this.equalsTo instanceof Me&&(this.valueCursor=this.equalsTo,this.equalsTo=this.valueCursor.get()),null==this.equalsTo&&(this.equalsTo=null)),Ke._super.init.call(this)},inputChange:function(e){this.updateEqualsToValue(),this.updateModel(!!this.element.checked&&this.equalsTo,e)},refresh:function(){this.element.checked=this.matchValue()},matchValue:function(){var e=this.value;return null==e&&(e=null),this.updateEqualsToValue(),e===this.equalsTo},updateEqualsToValue:function(){this.options.params.length>0&&this.valueCursor&&(this.equalsTo=this.valueCursor.get(),null==this.equalsTo&&(this.equalsTo=null))},fill:function(){this.fillVal||(this.fillVal=this.element.checked),this.updateModel(this.fillVal)}});Le.registerBinder("check",Ke);var Ue=o({extend:He},{constructor:function(e){He.call(this,e),this.equalsTo=void 0,this.valueCursor=void 0},init:function(){this.equalsTo=!0,this.options.params[0]&&(this.equalsTo=this.convertBindingValue(this.options.params[0]),this.equalsTo instanceof Me&&(this.valueCursor=this.equalsTo,this.equalsTo=this.valueCursor.get()),null==this.equalsTo&&(this.equalsTo=null)),Ue._super.init.call(this)},matchValue:function(){var e=this.value;return null==e&&(e=null),this.updateEqualsToValue(),e===this.equalsTo},updateEqualsToValue:function(){this.options.params.length>0&&this.valueCursor&&(this.equalsTo=this.valueCursor.get(),null==this.equalsTo&&(this.equalsTo=null))},refresh:function(){this.element.disabled=this.matchValue()},fill:function(){this.fillVal||(this.fillVal=!!this.element.disabled&&this.equalsTo),this.updateModel(this.fillVal)}});Le.registerBinder("disabled",Ue);var Je=o({extend:He},{constructor:function(e){He.call(this,e),this.equalsTo=void 0,this.valueCursor=void 0},init:function(){this.equalsTo=!0,this.options.params[0]&&(this.equalsTo=this.convertBindingValue(this.options.params[0]),this.equalsTo instanceof Me&&(this.valueCursor=this.equalsTo,this.equalsTo=this.valueCursor.get()),null==this.equalsTo&&(this.equalsTo=null)),Je._super.init.call(this)},matchValue:function(){var e=this.value;return null==e&&(e=null),this.updateEqualsToValue(),e!==this.equalsTo},updateEqualsToValue:function(){this.options.params.length>0&&this.valueCursor&&(this.equalsTo=this.valueCursor.get(),null==this.equalsTo&&(this.equalsTo=null))},refresh:function(){this.element.disabled=this.matchValue()},fill:function(){this.fillVal||(this.fillVal=!this.element.disabled&&this.equalsTo),this.updateModel(this.fillVal)}});Le.registerBinder("disablednot",Je);var Xe=o({extend:He},{constructor:function(e){He.call(this,e)},init:function(){this.styleProperty=this.options.params[0]?this.convertBindingValue(this.options.params[0]):null,this.styleUnit=this.options.params[1]?this.convertBindingValue(this.options.params[1]):"",Xe._super.init.call(this)},refresh:function(){var e=this.value;if(this.styleProperty)if(void 0===e)delete this.element.style[this.styleProperty];else{this.styleUnit&&(e+=this.styleUnit);try{this.element.style[this.styleProperty]=e}catch(e){}}}});Le.registerBinder("style",Xe);var Ge=o({extend:Ze},{constructor:function(e){0===e.eventNames.length&&(e.eventNames=["click"]),Ze.call(this,e)}});Le.registerBinder("click",Ge);var Qe=o({extend:Ze},{constructor:function(e){0===e.eventNames.length&&(e.eventNames=["dblclick"]),Ze.call(this,e)}});Le.registerBinder("dblclick",Qe);var Ye=o({extend:Ze},{constructor:function(e){0===e.eventNames.length&&(e.eventNames=["focus"]),Ze.call(this,e)}});Le.registerBinder("focus",Ye);var et=o({extend:Ze},{constructor:function(e){0===e.eventNames.length&&(e.eventNames=["blur"]),Ze.call(this,e)}});Le.registerBinder("blur",et);var tt=o({extend:Ze},{constructor:function(e){0===e.eventNames.length&&(e.eventNames=["focus blur"]),Ze.call(this,e)},triggerEvent:function(e){this.updateModel(this.view.env.document.activeElement===this.element,e)},refresh:function(){this.value?this.view.env.document.activeElement!==this.element&&this.element.focus():this.view.env.document.activeElement===this.element&&this.element.blur()}});Le.registerBinder("focusblur",tt);var it=o({extend:He},{constructor:function(e){He.call(this,e)},refresh:function(){var e=this.value;null!==e&&void 0!==e||(e=""),this.element.innerHTML=e}});Le.registerBinder("html",it);var nt=o({extend:He},{constructor:function(e){var t=e.eventNames.length>0?e.eventNames.join(" "):"click";e=e||{},e.events=[[t,"inputChange"]],He.call(this,e),this.options.fill&&(this.fillVal=this.element.checked)},inputChange:function(e){this.element.checked&&this.updateModel(this.element.value,e)},refresh:function(){this.element.checked=this.parse(this.element.value)===this.currentValue},fill:function(){this.fillVal||(this.fillVal=this.element.checked),this.fillVal&&this.updateModel(this.element.value)}});Le.registerBinder("radio",nt);var st=o({extend:He},{constructor:function(e){He.call(this,e),this.prefix="",this.suffix="",e.params.forEach(this.f(function(e){"namedParam"===e.type&&("prefix"===e.name?this.prefix=e.operand.value:"suffix"===e.name&&(this.suffix=e.operand.value))}))},refresh:function(e){var t=this.value;null!==t&&void 0!==t||(t=""),t=this.prefix+t+this.suffix,this.element.textContent=t}});"object"==typeof document&&null!==document&&("textContent"in document.documentElement||(st.prototype.refresh=function(e){var t=this.value;null!==t&&void 0!==t||(t=""),t=this.prefix+t+this.suffix,this.element.innerText=t})),Le.registerBinder("text",st);var rt=o({extend:He},{constructor:function(e){var t=e.eventNames.length>0?e.eventNames.join(" "):"keypress keydown drop change";e.events=[[t,"inputChange"]],this.multiple=!1,He.call(this,e),this.options.fill&&(this.fillVal=this.getValue())},init:function(){this.multiple="SELECT"===this.element.nodeName&&this.element.multiple,this.multiple&&(this.getValue=this.getArrayValue,this.setValue=this.setArrayValue,this.compareValues=i),this.options.eventFilters&&this.options.eventFilters[0]&&(this.inputChange=this.createFilterTriggerEvent(this.inputChange,this.options.eventFilters[0])),He.prototype.init.call(this)},inputChange:function(e){oe(this.f(function(){this.updateModel(this.getValue(),e)}))},refresh:function(){var e=this.getFormattedValue();null!==e&&void 0!==e||(e=""),"SELECT"===this.element.nodeName?oe(this.f(function(){this.setValue(e)})):this.setValue(e)},fill:function(){this.fillVal||(this.fillVal=this.getValue()),this.updateModel(this.fillVal)},getValue:function(){return this.element.value},setValue:function(e){""!=e&&"file"===this.element.type||(this.element.value=e)},getArrayValue:function(){for(var e,t=[],i=this.element&&this.element.options,n=0,s=i.length;n<s;n++)e=i[n],e.selected&&t.push(e.value||e.text);return t},setArrayValue:function(e){Array.isArray(e)||(e=[e]);for(var i,n=this.element&&this.element.options,s=0,r=n.length;s<r;s++)i=n[s],i.selected=t(e,this.parse(i.value))!==-1}});Le.registerBinder("val",rt);var ot=o({extend:He},{constructor:function(e){He.call(this,e),this.appendedTextNode=null,this.addWhiteSpace=!1,this.prefix="",this.suffix="",e.params.forEach(this.f(function(e){"namedParam"===e.type&&("ws"===e.name&&e.operand.value===!0?this.addWhiteSpace=!0:"prefix"===e.name?this.prefix=e.operand.value:"suffix"===e.name&&(this.suffix=e.operand.value))}))},destroy:function(){this.appendedTextNode=null,ot._super.destroy.call(this)},refresh:function(e){var t=this.value;null!==t&&void 0!==t||(t=""),t=this.prefix+t+this.suffix,""!==t&&this.addWhiteSpace&&(t=" "+t),this.appendedTextNode?this.appendedTextNode.textContent=t:(this.appendedTextNode=document.createTextNode(t),this.element.appendChild(this.appendedTextNode))}});Le.registerBinder("textappend",ot);var lt=o({extend:He},{constructor:function(e){He.call(this,e),this.prependedTextNode=null,this.addWhiteSpace=!1,this.prefix="",this.suffix="",e.params.forEach(this.f(function(e){"namedParam"===e.type&&("ws"===e.name&&e.operand.value===!0?this.addWhiteSpace=!0:"prefix"===e.name?this.prefix=e.operand.value:"suffix"===e.name&&(this.suffix=e.operand.value))}))},destroy:function(){this.prependedTextNode=null,lt._super.destroy.call(this)},refresh:function(e){var t=this.value;null!==t&&void 0!==t||(t=""),t=this.prefix+t+this.suffix,""!==t&&this.addWhiteSpace&&(t+=" "),this.prependedTextNode?this.prependedTextNode.textContent=t:(this.prependedTextNode=document.createTextNode(t),this.element.insertBefore(this.prependedTextNode,this.element.firstChild))}});Le.registerBinder("textprepend",lt);var ht=function(e){var t=o({extend:He},{constructor:function(e){He.call(this,e),this.className=void 0,this.equalsTo=void 0,this.valueCursor=void 0},init:function(){this.className=this.convertBindingValue(this.options.params[0])||null,this.equalsTo=!0,this.valueCursor=void 0,this.options.params[1]&&(this.equalsTo=this.convertBindingValue(this.options.params[1]),this.equalsTo instanceof Me&&(this.valueCursor=this.equalsTo,this.equalsTo=this.valueCursor.get()),null==this.equalsTo&&(this.equalsTo=null)),this.negate="ne"===this.options.params[2]||e,t._super.init.call(this)},refresh:function(){this.className&&(this.matchValue()?this.animate?this.view.scope[this.animate].addClass(this.element,this.className):this.element.classList.add(this.className):this.animate?this.view.scope[this.animate].removeClass(this.element,this.className):this.element.classList.remove(this.className))},matchValue:function(){var t=this.value;return null==t&&(t=null),this.options.params.length>1?(this.valueCursor&&(this.equalsTo=this.valueCursor.get(),null==this.equalsTo&&(this.equalsTo=null)),e?t!==this.equalsTo:t===this.equalsTo):e?!t:!!t}});return t},ut=ht(!1),at=ht(!0);Le.registerBinder("class",ut),Le.registerBinder("classnot",at);var ct=function(e,t){return o({extend:He},{constructor:function(e){He.call(this,e),this.equalsTo=void 0,this.valueCursor=void 0,this.isInitialized=!1,this.isRendered=!1},init:function(){this.equalsTo=!0,this.valueCursor=void 0,this.options.params[0]&&(this.equalsTo=this.convertBindingValue(this.options.params[0]),this.equalsTo instanceof Me&&(this.valueCursor=this.equalsTo,this.equalsTo=this.valueCursor.get()),null==this.equalsTo&&(this.equalsTo=null)),this.isInserted=!0,t&&(this.isRun=!1,this.isRendered=!0,this.renderSubviews=this.view.renderSubviews,this.runSubviews=this.view.runSubviews,this.afterRunSubviews=this.view.afterRunSubviews,this.destroySubviews=this.view.destroySubviews,this.view.renderSubviews=m,this.view.runSubviews=m,this.view.afterRunSubviews=m,this.view.destroySubviews=m),He.prototype.init.call(this),this.isInitialized=!0},destroy:function(){if(this.isInitialized){if(t&&(this.view.renderSubviews=this.renderSubviews,this.view.runSubviews=this.runSubviews,this.view.afterRunSubviews=this.afterRunSubviews,this.view.destroySubviews=this.destroySubviews),!this.isInserted&&this.anchor){var e=this.anchor.parentNode;e&&e.replaceChild(this.element,this.anchor),this.isInserted=!0}this.anchor=null,this.isInitialized=!1,this.isRendered=!1,He.prototype.destroy.call(this)}},refresh:function(){if(this.isInitialized){var e;this.anchor||(this.anchor=this.view.env.document.createTextNode(""),this.element.parentNode.insertBefore(this.anchor,this.element));var i=U,n=J;if(this.animate&&(i=this.view.scope[this.animate].insert,n=this.view.scope[this.animate].remove),this.matchValue())t&&(this.isRendered||(this.renderSubviews.call(this.view),this.isRendered=!0),this.isRun||(this.runSubviews.call(this.view),this.afterRunSubviews.call(this.view),this.isRun=!0)),this.isInserted||(e=this.anchor.parentNode,e&&(i(e,this.anchor,this.element),this.isInserted=!0));else if(this.isInserted){if(e=this.element.parentNode){var s=this.isRun?n:J;s(e,this.element,this.f(function(){t&&this.isRendered&&(this.destroySubviews.call(this.view),this.isRendered=!1,this.isRun=!1),this.isInserted=!1})),this.isInserted=!1}}else t&&this.isRendered&&(this.destroySubviews.call(this.view),this.isRendered=!1,this.isRun=!1)}},matchValue:function(){var t=this.value;return null==t&&(t=null),this.options.params.length>0?(this.valueCursor&&(this.equalsTo=this.valueCursor.get(),null==this.equalsTo&&(this.equalsTo=null)),e?t!==this.equalsTo:t===this.equalsTo):e?!t:!!t}})},dt=ct(!1,!0),ft=ct(!0,!0);Le.registerBinder("if",dt),Le.registerBinder("ifnot",ft);var pt=Object.freeze({parser:Pe,settings:ee,arrayConcat:e,arrayIndexOf:t,compareArrays:i,bindFn:n,createClass:o,deepMixins:h,extend:r,isPlainObject:l,log:u,mixins:s,setImmediate:oe,curry:a,compose:c,map:le,imclone:d,imset:f,imremove:p,immerge:v,noop:m,afterRepaint:g,viewClassFactory:b,Cursor:Me,EventStream:Fe,View:Le,BinderMap:ze,Binder:He,CollectionBinder:je,ModelView:We,Dispatcher:Oe,EventBinder:Ze,AttrBinder:$e,CheckBinder:Ke,DisabledBinder:Ue,DisabledNotBinder:Je,StyleBinder:Xe,ClickBinder:Ge,DoubleClickBinder:Qe,FocusBinder:Ye,BlurBinder:et,FocusBlurBinder:tt,HtmlBinder:it,RadioBinder:nt,TextBinder:st,ValueBinder:rt,TextAppendBinder:ot,TextPrependBinder:lt,ClassBinder:ut,ClassNotBinder:at,IfBinder:dt,IfNotBinder:ft});return pt});
